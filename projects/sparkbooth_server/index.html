<!DOCTYPE html><html lang="en" class=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Sparkbooth Server | Jon Hollander</title><meta name="description" content="Data-driven API Creation"> <!-- Web font CDN - TODO - update with final font selection --><link href="https://fonts.googleapis.com/css?family=Homenaje|Montserrat|Secular+One|Teko:500" rel="stylesheet"><link rel="stylesheet" href="/css/styles.css"> <!-- CSS animation for logos --><link rel="stylesheet" type="text/css" href="/css/jh_logo.css"><link rel="canonical" href="http://localhost:4000/projects/sparkbooth_server/"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png"><link rel="manifest" href="/images/favicons/manifest.json"><link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#171717"><link rel="shortcut icon" href="/favicon.ico"><meta name="msapplication-config" content="/images/favicons/browserconfig.xml"><meta name="theme-color" content="#171717"><meta property="og:type" content="website"/><meta property="og:url" content="http://localhost:4000/projects/sparkbooth_server/"/><meta property="og:title" content="Sparkbooth Server"/><meta property="og:description" content="Data-driven API Creation"/><meta property="og:image" content="http://localhost:4000/projects/sparkbooth_server/"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="900"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content=""/><meta name="twitter:creator" content=""/><meta name="twitter:title" content="Sparkbooth Server"/><meta name="twitter:description" content="Data-driven API Creation"/><meta name="twitter:image" content="http://localhost:4000/images/projects/sparkbooth_server/api_flow.svg"/></head><body class=""><div class="global-wrapper"> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebSite", "name": "Jon Hollander", "url": "http://www.jonhollander.me" } </script><header class="main-header" data-header><div class="header-content"> <a class="accessibility-skip" href="#maincontent">Skip to main content</a><div class="logo-nav-wrapper"><div class="logo-title-wrapper"><div class="logo"> <a class="wordmark-simple" href="/"><h1><div class="wordmark-simple">JH</div></h1></a></div><!-- --><div class="desktop-page-title"><h1>Sparkbooth Server</h1></div></div><nav class="navigation" aria-label="main navigation"> <a href="javascript:void(0)" class="mobile-nav">Menu</a><div class="mobile-nav-wrapper"><ul class="mobile-dropdown" itemscope itemtype="http://schema.org/SiteNavigationElement"><li> <a class="current" itemprop="url" href="/"><span itemprop="name">Projects</span></a></li><li> <a itemprop="url" href="/posts"><span itemprop="name">Posts</span></a></li><li> <a itemprop="url" href="/about"><span itemprop="name">About</span></a></li></ul></div></nav></div></div></header><main class="main-content " id="maincontent"><div class="page-title-wrapper"> <!--<div class="page-title project"><h1> Sparkbooth Server</h1></div>--></div><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BreadcrumbList", "itemListElement": [{ "@type": "ListItem", "position": 1, "item": { "@id": "http://localhost:4000/projects/", "name": "Projects" } },{ "@type": "ListItem", "position": 2, "item": { "@id": "http://localhost:4000/projects/sparkbooth_server/", "name": "Sparkbooth Server", "image": "http://localhost:4000/images/projects/sparkbooth_server/api_flow.svg" } }] } </script><div class="project-wrapper"><div class="project-info"><section class="project-intro paragraph-main"><p>Sparkbooth server is a cloud services interface for a popular photobooth application. Sparkbooth server enables photobooth clients to share pictures via e-mail, SMS messaging, and various social media platforms. Sparkbooth server uses a data-driven, self-documenting, modular API processing system to support rapid integration and updates with additional APIs.</p><p>Built with server-side javascript using node.js, Express, and Windows Azure table and blob storage</p></section><aside class="project-details"><div class="project-detail-wrapper"><div class="project-detail project-detail-6 project-detail-first"><h3 class="project-detail-property-title">Disciplines</h3><span class="keep-line-wrap">API design,</span> <span class="keep-line-wrap"> Back-end Development,</span> <span class="keep-line-wrap"> Cloud Integration</span></div><div class="project-detail project-detail-6 project-detail-first"><h3 class="project-detail-property-title">Tools</h3><span class="keep-line-wrap">Node.js,</span> <span class="keep-line-wrap"> Azure Storage,</span> <span class="keep-line-wrap"> OAuth,</span> <span class="keep-line-wrap"> Twilio</span></div><div class="project-detail project-detail-6"><h3 class="project-detail-property-title">Year</h3><p>2013</p></div><div class="project-detail project-detail-12"> <a href="http://www.sparkbooth.com/" class="button-secondary">Visit wazer</a></div></div></aside></div><section><div class="layout-text"><section class="project-text"><div class="project-text-wrapper paragraph-main"><h2 id="background">Background</h2><p>In 2013, I wrote a web services server for my <a href="http://www.johnwu.com/" title="The Real John Wu">friend’s</a> popular <a href="http://sparkbooth.com/" title="Sparkbooth Photobooth Software">photobooth software</a>.  Until then, the photobooth software was a heavyweight client application.  However, he wanted to add more sharing and social functions, such as sending photobooth pictures to users via texting and e-mail.  Also, some recent changes in Tumblr’s API made uploading pictures directly from the client rather burdensome.   For these and other reasons, he wanted to create a web server to handle all of the social and sharing integration.</p><h2 id="the-problem-so-many-apis-to-connect-together">The Problem: So Many APIs to Connect Together</h2><p>It seems that virtually every conceivable function is available via a REST API.  The primary purpose of the web services server is to act as “glue” for all of these various services.  </p><p>For this project, the initial set of APIs included:</p><ul><li>Cloud table storage for the server’s own data</li><li>Cloud blob storage to temporarily store pictures</li><li>Text messaging (SMS and MMS) service to send and receive text messages and photobooth pictures</li><li>E-mail service to request and receive photobooth pictures</li><li>Tumblr upload integration</li><li>OAuth Callback API</li><li>A photobooth client API to enable photobooth applications to access these web services</li></ul><p>Some of these interfaces are outgoing-only, but others, such as the e-mail and SMS interfaces, are two-way and may receive calls from the cloud at anytime.  Additionally, we needed the ability to quickly add other social and sharing services to the server, support API versioning, and a server administration and testing interface.  Because these APIs are exposed to the web, user authentication, URL validation, and API parameter validation are extremely important.</p><h2 id="data-driven-api-processing-eliminates-the-tedium-of-supporting-different-apis">Data-driven API Processing Eliminates the Tedium of Supporting Different APIs</h2><p>Rather than trying to implement each of these APIs separately, I decided to build a data-driven, self-documenting, modular API processing system.  Each API is defined by a Javascript object that defines that API’s specific function calls, associated URLs, and parameters. This API specification object is used by the server to process all incoming web requests and generate a testing interface.</p><p>By controlling the API processing pipeline using the API specification object, changes or modifications to an API specification object are automatically implemented by the server. Additionally, new API functions and even entirely new APIs can be easily added just by passing their API specification objects to the API processing pipeline. Despite being code, the API specification objects are easy to read and understand.</p><h2 id="api-specification-object">API Specification Object</h2><p>For example, this is an abridged API specification:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">PhotocacheAPIList</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span><span class="s2">"uploadPhoto"</span><span class="p">,</span>
        <span class="na">version</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span><span class="s2">"api/cache/v1/uploadphoto"</span><span class="p">,</span>
        <span class="na">callback</span><span class="p">:</span><span class="s2">"uploadPhotoToCache"</span><span class="p">,</span>
        <span class="na">enctype</span><span class="p">:</span><span class="s2">"multipart/form-data"</span><span class="p">,</span>
        <span class="na">params</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="na">name</span><span class="p">:</span> <span class="s2">"uploadFile"</span><span class="p">,</span>
                <span class="na">type</span><span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
                <span class="na">inputtype</span><span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span>
                <span class="na">optional</span><span class="p">:</span> <span class="kc">true</span>								
            <span class="p">}</span>
            <span class="p">,{</span>
                <span class="na">name</span><span class="p">:</span> <span class="s2">"tempFilePath"</span><span class="p">,</span>
                <span class="na">type</span><span class="p">:</span> <span class="s2">"path"</span><span class="p">,</span>
                <span class="na">hidden</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
                <span class="na">optional</span><span class="p">:</span> <span class="kc">false</span>								
            <span class="p">}</span>														
        <span class="p">]</span>
    <span class="p">}</span> 
    <span class="p">,</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span><span class="s2">"deletePhoto"</span><span class="p">,</span>
            <span class="na">version</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span>
            <span class="na">url</span><span class="p">:</span><span class="s2">"api/cache/v1/deletecachedphoto"</span><span class="p">,</span>
            <span class="na">callback</span><span class="p">:</span><span class="s2">"deleteCachedPhoto"</span><span class="p">,</span>
            <span class="na">params</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">name</span><span class="p">:</span> <span class="s2">"cachecode"</span><span class="p">,</span>
                    <span class="na">type</span><span class="p">:</span> <span class="s2">"alpha-numeric"</span><span class="p">,</span>
                    <span class="na">optional</span><span class="p">:</span><span class="kc">false</span>
                <span class="p">}</span>							
            <span class="p">]</span>
    <span class="p">}</span>			       
<span class="p">];</span>
</code></pre></div></div><p>This Javascript array includes objects representing each API function. Each API function’s specification object includes the function name, version, calling URL, the callback function used to process the API call, and any function parameters. For each API function’s parameters, this object specifies the parameter names, the parameters’ data types, and whether the parameters are required or optional.</p><h2 id="processing-api-requests-using-the-api-specification-object">Processing API Requests Using the API Specification Object</h2><p>The web services server processes all incoming requests as follows:  </p></div></section></div><div class="layout-2col"><figure class="image-wrapper "> <img class="blue-shadow" src="/images/projects/sparkbooth_server/api_flow.svg" alt="API request process flow"></figure></div><div class="layout-text"><section class="project-text"><div class="project-text-wrapper paragraph-main"><p>The server initializes the API processing pipeline with the API specification objects for the supported API. The API processing pipeline then uses these API specification objects to evaluate each incoming API request.</p><p>If all of the required parameters are present, then the server validates and sanitizes the API request’s parameters (including any optional or extraneous parameters). The server validates parameters using a standard validation module, wrapped in another module to allow for user-defined parameter types.</p><p>If the server matches an incoming API request to an API specification object and passes all of these validation steps, then it forwards the API request to the callback function in the API specification object for processing.</p><h2 id="other-uses-for-the-api-specification-object">Other Uses for the API Specification Object</h2><p>In addition to controlling the API processing pipeline, these API specification objects can be used for other purposes, such as for documentation and testing. For example, I also use it to generate a web-based testing interface. The server passes the set of API specification objects to a Jade web template and generates a web testing page including a set of web forms for the API functions. Each web form is configured with the URL and parameters of one of the API functions. The resulting web page includes web forms for all of the API functions.</p></div></section></div></section><section class="additional-content-wrapper"><div class="additional-content"></div></section></div></main><footer><div class="footer-content"><div class="footer-content-wrapper"> <!--<p class="license">Test</p>--> <!--<p class="license">Updated <span id="currentYear">2019</span><noscript></noscript> Jon Hollander</p>--> <!--<p class="license">Updated 2019<noscript></noscript> Jon Hollander</p>--></div></div></footer><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> <script type="text/javascript"> $(document).ready(function() { $('.mobile-nav').on('click', function(){ $('.navigation').toggleClass('show'); $('.mobile-nav').html(function(i, label){ return label === 'Menu' ? '&times; Close' : 'Menu' }); $("body").toggleClass("prevent-scroll-mobile"); $("header.main-header").toggleClass("header-prevent-hide"); }); }); !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Headspace=t()}(this,function(){"use strict";function e(s){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(!(this instanceof e))return new(Function.prototype.bind.apply(e,[null].concat(Array.prototype.slice.call(arguments))));this.element=s,this.startOffset=t(n.startOffset,s&&s.offsetHeight),this.tolerance=t(n.tolerance,8),this.showAtBottom=t(n.showAtBottom,!0),this.classNames=n.classNames||{base:"headspace",fixed:"headspace--fixed",hidden:"headspace--hidden"},this._scrollLast=0,"undefined"!=typeof window&&this.init()}function t(e,t){return void 0!==e?e:t}function s(e){var t=window.pageYOffset,s=e._scrollLast;t<=0?e.reset():e.showAtBottom&&window.innerHeight+t>=document.body.offsetHeight?e.fix():t>e.startOffset&&Math.abs(t-s)>=e.tolerance&&e[t>s?"hide":"fix"](),e._scrollLast=t}return e.prototype={init:function(){var e=this;this.addClass(this.classNames.base),window.addEventListener("scroll",function(){return e.debounce(function(){return s(e)})})},reset:function(){var e=this.classNames;this.removeClass(e.fixed,e.hidden)},fix:function(){var e=this.classNames;this.addClass(e.fixed),this.removeClass(e.hidden)},hide:function(){this.addClass(this.classNames.hidden)},addClass:function(){var e;(e=this.element.classList).add.apply(e,arguments)},removeClass:function(){var e;(e=this.element.classList).remove.apply(e,arguments)},debounce:function(e){window.requestAnimationFrame(e)}},e.isSupported=function(){return!!("undefined"!=typeof window&&window.requestAnimationFrame&&"classList"in document.documentElement)},e}); var date = new Date().getFullYear(); document.getElementById("currentYear").innerHTML = date; $(function () { Headspace(document.querySelector('[data-header]'), { startOffset: 90, tolerance: 5, showAtBottom: false, classNames: { base: 'sticky-header', fixed: 'sticky-header--fixed', hidden: 'sticky-header--hidden' } }) }()); </script></div><!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40935033-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-40935033-1'); </script></body></html>
